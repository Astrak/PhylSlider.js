var PhylSlider=function(a){"use strict";function b(){E=document.createElementNS("http://www.w3.org/2000/svg","svg"),F=document.createElement("div"),G=document.createElement("div"),H=document.createElement("div"),I=document.createElement("button"),E.setAttribute("class","phylslider-svg"),J.width&&E.setAttribute("width",J.width),J.height&&E.setAttribute("height",J.height),F.className="phylslider-thumb",F.style.cssText="position:absolute;cursor:pointer;box-shadow:0 0 10px black;width:50px;height:50px;border-radius:50%;background:#444;margin:-25px 0 0 -25px;-webkit-tap-highlight-color:rgba(0,0,0,0);",G.style.position="relative",I.innerHTML="switch",I.style.cssText="position:absolute;top:0;left:0;-webkit-tap-highlight-color:rgba(0,0,0,0);",H.appendChild(G),G.appendChild(E),G.appendChild(F),a.switchableStyle!==!1&&(I.addEventListener("click",c,!1),G.appendChild(I))}function c(){J.bezier=!J.bezier,J.setSlider(),r&&t&&F.from&&F.to&&(J.bezier?(q=o((t-F.from.x)/(F.to.x-F.from.x),{x:F.from.x,y:F.from.y},{x:F.to.x,y:F.to.y}),F.style.left=q.x+"px",F.style.top=q.y+"px"):(u=(F.to.y-F.from.y)/(F.to.x-F.from.x),v=F.from.y-u*F.from.x,F.style.left=t+"px",F.style.top=u*t+v+"px"))}function d(a,b,c){if(a.hasOwnProperty("age")?(N=N<a.age?N:a.age,O=O>a.age?O:a.age):(b="undefined"==typeof b?0:b,a.age=b,O=O>a.age?O:a.age),a.hasOwnProperty("tween")&&"object"==typeof a.tween?z=a.tween:a.tween={},a.tweenFrom="undefined"==typeof c?a.tween:c,a.hasOwnProperty("children")){var e=a.hasOwnProperty("xEnd")?a.xEnd:10,f=a.hasOwnProperty("yEnd")?a.yEnd:E.height/2;a.children.forEach(function(c){c.xStart=e,c.yStart=f,d(c,b+1,a.tween)})}}function e(a,b){a.setAttribute("fill",J.fill),a.setAttribute("stroke-width",J.strokeWidth),a.setAttribute("stroke-linecap",J.strokeLinecap);var c="off"!==b.mode||b.hasOwnProperty("children")&&"off"!==b.children[0].mode&&"circle"===a.localName&&a.getAttribute("cx")!=b.xStart?J.stroke:J.colorOff;a.setAttribute("stroke",c),a.style.cursor="pointer",a.style.WebkitTapHighlightColor="rgba(0,0,0,0)"}function f(a,b){var c=function(a,b){a.style.color=J.color,a.style.cursor="pointer",a.style.transition="all 200ms ease",a.style.WebkitTapHighlightColor="rgba(0,0,0,0)",a.onmouseover=function(){a.style.color=J.stroke},a.onmouseout=function(){a.style.color=J.color},a.onclick=function(){J.setThumb(a.innerHTML)}};a.style.position="absolute",a.style.visibility="hidden",a.style.display="table",a.style.margin=0,a.style.fontSize=J.fontSize,a.style.fontFamily=J.fontFamily,a.style.fontFamily=J.fontFamily,a.style.fontWeight="bold",a.style.fontStyle="italic",b.hasOwnProperty("mode")&&"off"===b.mode?b.hasOwnProperty("content0")&&a.innerHTML===b.content0?a.style.color=J.colorOff:!b.hasOwnProperty("children")||b.children[0].hasOwnProperty("mode")&&"off"===b.children[0].mode?a.style.color=J.colorOff:c(a,b):c(a,b),document.body.appendChild(a);var d={width:Math.ceil(a.getBoundingClientRect().width),height:Math.ceil(a.getBoundingClientRect().height)};document.body.removeChild(a),a.style.visibility="visible";var e=b.hasOwnProperty("contentX")?b.contentX:0,f=b.hasOwnProperty("contentY")?b.contentY:0,g=b.hasOwnProperty("content0")&&b.content0===a.innerHTML?b.xStart:b.xEnd,h=b.hasOwnProperty("content0")&&b.content0===a.innerHTML?b.yStart:b.yEnd;if(a.innerHTML!==b.content0)if(e||f){a.style.left=g+e-d.width/2+"px",a.style.top=h+f-d.height/2+"px",P=Math.max(P,g+d.width/2+e),Q=Math.min(Q,g-d.width/2+e);var i=document.createElementNS("http://www.w3.org/2000/svg","path"),j="off"===b.mode?J.colorOff:J.color;i.setAttribute("stroke",j),i.setAttribute("stroke-width",1);var k="M"+g+","+h+" "+(g+e-d.width/2)+","+(h+f+d.height);i.setAttribute("d",k),E.appendChild(i)}else if(b.children||!b.children&&b.age!==O){Q=Math.min(g-d.width-30,Q);var i=document.createElementNS("http://www.w3.org/2000/svg","path"),j="off"===b.mode?J.colorOff:J.color;i.setAttribute("stroke",j),i.setAttribute("stroke-width",1);var k="M"+g+","+h+" "+(g-20)+",";b.yStart>=h?(a.style.left=g-d.width-20+"px",a.style.top=h-d.height-20+"px",k+=h-d.height/2-10):(a.style.left=g-d.width+"px",a.style.top=h+d.height+7+"px",k+=h+d.height/2+10),i.setAttribute("d",k)}else{a.style.left=g+30+e+"px",a.style.top=h-d.height/2+f+"px",P=Math.max(g+e+30+d.width,P);var i=document.createElementNS("http://www.w3.org/2000/svg","path"),j="off"===b.mode?J.colorOff:J.color;i.setAttribute("stroke",j),i.setAttribute("stroke-width",1);var k="M"+g+","+h+" "+(g+20)+","+h;i.setAttribute("d",k)}else(b.content0X||b.content0Y)&&(a.style.top=b.content0Y+"px",a.style.left=b.content0X+"px",P=Math.max(P,g+d.width+b.content0X),Q=Math.min(Q,g+b.content0X))}function g(a){if(A=J.bezier?a.xStart+(a.xEnd-a.xStart)/2:a.xStart,B=J.bezier?a.xEnd-(a.xEnd-a.xStart)/2:a.xEnd,a.hasOwnProperty("content0")){var b=document.createElement("p");b.innerHTML=a.content0,f(b,a),G.appendChild(b);var c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx",a.xStart),c.setAttribute("cy",a.yStart),c.setAttribute("r",J.strokeWidth/2),e(c,a),E.appendChild(c)}var b=document.createElement("p");b.innerHTML=a.content,f(b,a),G.appendChild(b);var c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx",a.xEnd),c.setAttribute("cy",a.yEnd),c.setAttribute("r",J.strokeWidth/2),e(c,a),E.appendChild(c);var d="M"+a.xStart+","+a.yStart+" C"+A+","+a.yStart+" "+B+","+a.yEnd+" "+a.xEnd+","+a.yEnd,g=document.createElementNS("http://www.w3.org/2000/svg","path");e(g,a),E.appendChild(g),g.setAttribute("d",d)}function h(a,b){b(a),"object"==typeof a&&a.hasOwnProperty("children")&&a.children.forEach(function(a){h(a,b)})}function i(a){if(a.target!==F&&"path"!==a.target.tagName&&"circle"!==a.target.tagName)return!1;for(a.preventDefault(),C=H.offsetParent,D={left:H.offsetLeft,top:H.offsetTop};C;)D.left+=C.offsetLeft,D.top+=C.offsetTop,C=C.offsetParent;return a.touches?(window.addEventListener("touchend",l,!1),window.addEventListener("touchmove",j,!1)):(window.addEventListener("mouseup",l,!1),window.addEventListener("mousemove",j,!1)),!1}function j(a){return a.preventDefault(),m(a),!1}function k(a){return("path"===a.target.tagName||"circle"===a.target.tagName)&&(a.preventDefault(),m(a),!1)}function l(){window.removeEventListener("mouseup",l,!1),window.removeEventListener("mousemove",j,!1),window.removeEventListener("touchend",l,!1),window.removeEventListener("touchmove",j,!1)}function m(a){r=a.touches?a.touches[0].pageX:a.pageX,s=a.touches?a.touches[0].pageY:a.pageY,J.setThumb(n(r-D.left+Q,s-D.top))}function n(a,b){return K=[],x=void 0,y=void 0,t=Math.min(Math.max(M,a),L),h(J.tree,function(a){a.xStart<=t&&a.xEnd>=t&&(!a.hasOwnProperty("mode")||"off"!==a.mode)&&(w=(t-a.xStart)/(a.xEnd-a.xStart),isNaN(w)&&(w=0),J.bezier?K.push(o(w,{x:a.xStart,y:a.yStart},{x:a.xEnd,y:a.yEnd},p(w,a.tweenFrom,a.tween))):(u=(a.yEnd-a.yStart)/(a.xEnd-a.xStart),isNaN(u)&&(u=0),v=a.yStart-u*a.xStart,K.push({x:t,y:u*t+v,tween:p(w,a.tweenFrom,a.tween),from:{x:a.xStart,y:a.yStart},to:{x:a.xEnd,y:a.yEnd}})))}),K.forEach(function(a,c){("undefined"==typeof x||Math.abs(a.y-b)<x)&&(x=Math.abs(a.y-b),y=c)}),h(J.tree,function(c){var d=Math.sqrt(Math.pow(a-c.xEnd,2)+Math.pow(b-c.yEnd,2));!c.children&&c.xEnd<L&&d<x&&(K[y]={x:c.xEnd,y:c.yEnd,from:{x:c.xStart,y:c.yStart},to:{x:c.xEnd,y:c.yEnd},tween:p(1,c.tweenFrom,c.tween)})}),{x:K[y].x,y:K[y].y,tween:K[y].tween,from:K[y].from,to:K[y].to}}function o(a,b,c,d){return V.y=b.y+a*(c.y-b.y),S.y=b.y+a*(V.y-b.y),T.y=V.y+a*(c.y-V.y),V.x=(c.x+b.x)/2,R.x=b.x+a*(V.x-b.x),U.x=V.x+a*(c.x-V.x),S.x=R.x+a*(V.x-R.x),T.x=V.x+a*(U.x-V.x),{x:S.x+a*(T.x-S.x),y:S.y+a*(T.y-S.y),tween:d,from:b,to:c}}function p(a,b,c){var d={};for(var e in b)b.hasOwnProperty(e)&&c.hasOwnProperty(e)&&(Array.isArray(b[e])&&Array.isArray(c[e])?(d[e]=[],b[e].forEach(function(b,f){d[e][f]=b*(1-a)+c[e][f]*a})):"number"==typeof b[e]&&"number"==typeof c[e]&&(d[e]=b[e]*(1-a)+c[e]*a));return d}if(!a.hasOwnProperty("tree"))return console.error("PhylSlider needs a tree !");this.tree=a.tree;var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J=this,K=[],L=0,M=100,N=0,O=0,P=0,Q=0,R={x:0,y:0},S={x:0,y:0},T={x:0,y:0},U={x:0,y:0},V={x:0,y:0};return this.fill=a.fill?a.fill:"none",this.color=a.hasOwnProperty("color")?a.color:"#000",this.colorOff=a.hasOwnProperty("colorOff")?a.colorOff:"#000",this.width=a.width?a.width:"",this.height=a.height?a.height:"",this.strokeWidth=a.strokeWidth?a.strokeWidth:8,this.strokeLinecap=a.strokeLinecap?a.strokeLinecap:"round",this.stroke=a.stroke?a.stroke:"#FFB300",this.fontFamily=a.fontFamily?a.fontFamily:"Verdana",this.fontSize=a.fontSize?a.fontSize:30,this.bezier=!!a.hasOwnProperty("bezier")&&a.bezier,this.callback=a.callback?a.callback:function(){},b(),this.svg=E,this.slider=H,this.setSlider=function(){for(;E.firstChild;)E.removeChild(E.firstChild);d(J.tree),h(J.tree,function(a){L=Math.max(a.xEnd,L),a.hasOwnProperty("mode")&&"off"===a.mode||(M=Math.min(a.xStart,M)),g(a)});for(var a=E.querySelectorAll("*[stroke='"+J.colorOff+"']"),b=0;b<a.length;b++)E.removeChild(a[b]),E.insertBefore(a[b],E.firstChild);G.style.marginLeft=-Q+"px",G.style.marginRight=P-J.width+"px",J.totalWidth=P-Q,H.addEventListener("mousedown",i,!1),H.addEventListener("touchstart",i,!1),E.addEventListener("click",k,!1),h(J.tree,function(a){if(a.xStart===M)return J.setThumb(M,a.yStart)})},this.setThumb=function(){if(1===arguments.length)if("string"==typeof arguments[0]){var a=arguments[0];h(J.tree,function(b){if(b.hasOwnProperty("content0")&&b.content0===a){F.style.left=b.xStart+"px",F.style.top=b.yStart+"px",F.from=b.tweenFrom,F.to=b.tweenTo,J.callback(b.tweenFrom);for(var c=G.getElementsByTagName("p"),d=0;d<c.length;d++)c[d].innerHTML===a&&(c[d].style.color=J.stroke)}else if(b.content===a){F.style.left=b.xEnd+"px",F.style.top=b.yEnd+"px",F.from=b.tweenFrom,F.to=b.tween,J.callback(b.tween);for(var c=G.getElementsByTagName("p"),d=0;d<c.length;d++)c[d].innerHTML===a&&(c[d].style.color=J.stroke)}})}else if("object"==typeof arguments[0]){var a=arguments[0];F.style.left=a.x+"px",F.style.top=a.y+"px",F.from=a.from,F.to=a.to,J.callback(a.tween)}arguments.length>1&&(F.style.left=arguments[0]+"px",F.style.top=arguments[1]+"px"),arguments.length>2&&(F.from=arguments[2],F.to=arguments[3]),arguments.length>4&&J.callback(arguments[4])},this.setSlider(),this};